#!/bin/bash

###############################################################################
# Phase: Init

IFACE_MAC_ADDR="6c:b3:11:66:85:d0"

IFACE_IP_ADDR="192.168.5.71"
IFACE_BRC_ADDR="192.168.5.255"

IFACE_VLAN_IP_ADDR="192.168.5.71"
IFACE_VLAN_BRC_ADDR="192.168.5.255"
IFACE_VLAN_ID="3"

TX_Q_COUNT=4
RX_Q_COUNT=4

VLAN_PRIORITY_SUPPORT="YES"
VLAN_STRIP_SUPPORT="NO"
EEE_TURNOFF="NO"

IRQ_AFFINITY_FILE="irq_affinity_4c_4TxRx.map"
TEMP_DIR="/tmp"

###############################################################################
# Phase: Setup
#           0 1 2 3 4 5 6
TAPRIO_MAP="3 1 0 2 3 3 3 3 3 3 3 3 3 3 3 3"
TAPRIO_SCHED=("sched-entry S 0F 1000000")

# i225 supports ETF and TAPRIO offload but i210 only supports ETF offload, we hack here to support i210
# TAPRIO_FLAGS="flags 0x2"

################## i210 ##################
TAPRIO_FLAGS="flags 0x1 clockid CLOCK_TAI"
################## i210 ##################

PTP_IFACE_APPEND=".vlan"
PTP_PHY_HW="i225-1G"

# i210 only supports ETF on queue 0/1
# PTP_TX_Q=2
################## i210 ##################
PTP_TX_Q=3      # socket priority 3 ---> TC/NIC tx-q 2
################## i210 ##################
PTP_RX_Q=2      # NIC rx-q 2

# ETF_Q=2
################## i210 ##################
ETF_Q=1         # socket priority 1 ---> TC/NIC tx-q 1
################## i210 ##################
ETF_DELTA=700000
#ETF_FLAGS="deadline_mode off skip_sock_check off"

IPERF_BITRATE=200M
CPU_AFFINITY=3
VLAN_PRIOR_PKT=0x6000
VLAN_PRIOR_AF_XDP=0x4000

###############################################################################
# Runtime

TARGET_IP_ADDR="192.168.5.41"

AFP_PACKET_TEST="y"
RUN_IPERF3_AFP="y"
RUN_IPERF3_XDP="y"

################## i210 ##################
TX_PKT_Q=1  # socket priority 1 ---> TC/NIC tx-q 1
RX_PKT_Q=1  # NIC rx-q 1

TX_XDP_Q=1  # socket priority 1 ---> TC/NIC tx-q 1
RX_XDP_Q=1  # NIC rx-q 1
################## i210 ##################

# TX_PKT_Q=3
# RX_PKT_Q=2

# TX_XDP_Q=2
# RX_XDP_Q=2

TXTIME_OFFSET=20000
NUMPKTS=10000
SIZE=64

INTERVAL=250000
EARLY_OFFSET=700000

XDP_MODE="cT -w"
XDP_INTERVAL=200000
XDP_EARLY_OFFSET=100000
